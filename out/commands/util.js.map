{"version":3,"file":"util.js","sourceRoot":"./src/","sources":["commands/util.ts"],"names":[],"mappings":"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","sourcesContent":["import { Collection, Message, MessageEditOptions, MessageMentions, MessageOptions, RichEmbed, RichEmbedOptions, User } from \"discord.js\";\nimport fs from \"fs-extra\";\nimport path from \"path\";\nimport Constants from \"../Constants\";\nimport \"./api\";\nimport { CommandError } from \"./errors\";\nimport { Argumented, ArgumentSDK, ArgumentType } from \"./guards/arguments\";\n\n\nexport enum AccessLevel {\n    EVERYONE = \"global\",\n    MODERATOR = \"moderator\",\n    ADMIN = \"admin\",\n    ROOT = \"root\"\n}\n\ndeclare module 'discord.js' {\n    interface GuildMember {\n        /**\n         * Whether this member has access to the given command\n         * @param command the command name\n         */\n        hasAccess(command: string): Promise<boolean>;\n    }\n\n    interface User {\n        /**\n         * Whether this user has access to the given command\n         * @param command the command name\n         */\n        hasAccess(command: string): Promise<boolean>;\n        /**\n         * Returns all visible guilds this user is in\n         */\n        guilds(): Promise<Collection<string, Guild>>;\n    }\n\n    interface Message {\n        /**\n         * Reacts with a success emoji\n         */\n        complete(): Promise<void>;\n        /**\n         * Reacts with a success emoji\n         */\n        success(): Promise<void>;\n        /**\n         * Reacts with a success emoji\n         */\n        done(): Promise<void>;\n        /**\n         * Reacts with a failure emoji\n         */\n        fail(): Promise<void>;\n        /**\n         * Render a command error\n         * @param error error to render\n         */\n        renderError(error: CommandError): Promise<void>;\n        /**\n         * Reacts with a warning indicator\n         */\n        warning(): Promise<void>;\n        /**\n         * Reacts with a warning indicator\n         */\n        caution(): Promise<void>;\n        /**\n         * Reacts with a warning indicator\n         */\n        danger(): Promise<void>;\n        /**\n         * The arguments provided for this command\n         */\n        args: ArgumentType[];\n        /**\n         * The command being executd by this message\n         */\n        command: Command;\n        /**\n         * Whether this message is executing a command\n         */\n        isCommand: boolean;\n        /**\n         * Command data store\n         */\n        data: {\n            [key: string]: any;\n        };\n        /**\n         * Whether the command sender has permission to execute this command\n         */\n        hasPermission: boolean;\n        /**\n         * Whether the command has been errored\n         */\n        errored: boolean;\n        /**\n         * Initial data passed to setup()\n         */\n        __data: any;\n        /**\n         * Initialize the message object\n         * @param data the data\n         * @private\n         */\n        setup(data: any);\n    }\n}\n\nexport interface CommandHandler {\n    (message: Message, next: (err?: any) => any): any;\n}\n\nexport interface CommandOptions {\n    access?: AccessLevel;\n    guards?: CommandHandler[];\n    category?: string;\n}\n\nexport interface Command {\n    opts: {\n        name: string;\n        node?: string;\n        enabled?: boolean;\n        aliases?: string[];\n        /**\n         * Storage for guards and command states\n         */\n        data?: {[key: string]: any};\n        usage?: {\n            description?: string;\n            args?: Array<ArgumentSDK.Argument | undefined>;\n        }\n    } & CommandOptions;\n    handler: CommandHandler;\n}\n\nexport class CommandBuilder {\n    private command: Partial<Command> = {};\n\n    public name(name: string) {\n        this.opts.name = name;\n        return this;\n    }\n\n    public enabled(enabled: boolean) {\n        this.opts.enabled = enabled;\n        return this;\n    }\n\n    public alias(alias: string | string[]) {\n        this.opts.aliases = (this.opts.aliases || (this.opts.aliases = [])).concat(alias);\n        return this;\n    }\n\n    public data(key: string, value: any) {\n        (this.opts.data || (this.opts.data = {}))[key] = value;\n        return this;\n    }\n\n    public access(access: AccessLevel) {\n        this.opts.access = access;\n        return this;\n    }\n\n    public guard(guard: CommandHandler | CommandHandler[]) {\n        this.opts.guards = (this.opts.guards || (this.opts.guards = [])).concat(guard);\n    }\n\n    public category(category: string) {\n        this.opts.category = category;\n    }\n\n    public handler(handler: CommandHandler) {\n        this.command.handler = handler;\n    }\n\n    private get opts(): {name?: string, enabled?: boolean, aliases?: string[], data?: {[key: string]: any}} & CommandOptions {\n        return this.command.opts || (this.command.opts = {} as any);\n    }\n\n    public get built(): Command {\n        return this.command as any;\n    }\n}\n\nexport interface Commands {\n    opts?: CommandOptions;\n    commands: Array<Command | Commands>;\n}\n\nexport namespace CommandUtils {\n    export function isCommandOptions(options: any): options is CommandOptions {\n        return typeof options === \"undefined\" ? true :\n            (typeof options.access === \"undefined\" || typeof options.access === \"number\") &&\n            (typeof options.guards === \"undefined\" || (Array.isArray(options.guards) && (options.guards as any[]).every(guard => typeof guard === \"function\")))\n    }\n    \n    export function isCommand(command: any): command is Command {\n        return typeof command.opts === \"object\" &&\n               typeof command.opts.name === \"string\" &&\n               (typeof command.opts.enabled === \"boolean\" || typeof command.opts.enabled === \"undefined\") &&\n               isCommandOptions(command.options) &&\n               typeof command.handler === \"function\";\n    }\n    \n    export function isCommands(commands: any): commands is Commands {\n        return (typeof commands.opts === \"undefined\" || isCommandOptions(commands.opts)) &&\n               (typeof commands.commands === \"object\" && Array.isArray(commands.commands));\n    }\n\n    /**\n     * Flattens a commands object into a command array\n     * \n     * @param param0 the commands to flatten\n     */\n    export async function flatten({opts, commands}: Commands): Promise<Command[]> {\n        let commandArray: Command[] = [];\n\n        for (let command of commands) {\n            // prevents modifications to the require.cache'd objects\n            command = Object.assign({}, command);\n            command.opts = command.opts ? Object.assign({}, command.opts) : {};\n            if (command.opts) command.opts.guards = [...(command.opts.guards || [])];\n\n            if (!opts) {\n                isCommand(command) ? commandArray.push(command) : commandArray = commandArray.concat(await flatten(command));\n                continue;\n            }\n\n            const {guards, access, category} = opts;\n\n            // guards have a hierarchy\n            if (guards) {\n                command.opts.guards = guards.concat(command.opts.guards || []);\n            }\n\n            // commands inherit access levels if they don't have one defined\n            if (access && !command.opts.access) {\n                command.opts.access = access;\n            }\n\n            if (typeof category === \"string\" && typeof command.opts.category === \"undefined\") {\n                command.opts.category = category;\n            }\n\n            if (isCommand(command)) {\n                // our work is done\n                commandArray.push(command);\n            } else {\n                // recursion!\n                commandArray = commandArray.concat(await flatten(command));\n            }\n        }\n\n        return commandArray;\n    }\n\n    /**\n     * Parses a POJSO and converts it to an array of commands\n     * \n     * @param module the plain object to parse\n     */\n    export async function parse(module: any, base: boolean = true): Promise<Command[]> {\n        // exports = {opts: {}, handler: () => any}\n        if (isCommand(module)) {\n            return [module];\n        }\n\n        // exports = {opts: {}, commands: []}\n        if (module.commands) {\n            return await flatten(module);\n        }\n\n        let commands: Command[] = [];\n        if (base) {\n            for (let key in module) {\n                const value = module[key];\n                commands = commands.concat(await parse(value, false));\n            }\n        }\n        \n        return commands;\n    }\n\n    export async function preloadMetadata(commands: Command[]): Promise<void> {\n        commands.forEach(command => {\n            if (command.opts.usage) {\n                (command.opts.guards || (command.opts.guards = [])).unshift(Argumented(command));\n            }\n        });\n    }\n\n    /**\n     * Parses a directory and all of it's sub-directories for commands.\n     * \n     * @param dir the path to the directory\n     */\n    export async function loadDirectory(dir: string, automaticCategoryNames?: boolean): Promise<Command[]> {\n        let contents = await fs.readdir(dir), commands: Command[] = [];\n\n        for (let content of contents) {\n            const location = path.resolve(dir, content);\n            const stat = await fs.stat(location);\n\n            // commands must be .js files\n            if (stat.isFile() && !location.endsWith(\".js\")) continue;\n\n            const newCommands = stat.isDirectory() ? await loadDirectory(location) : await parse(require(location));\n\n            if (automaticCategoryNames) {\n                let parentDirName: string | string[] = path.dirname(location).split('/');\n                parentDirName = parentDirName[parentDirName.length - 1];\n                for (let command of newCommands) {\n                    if (!!command.opts.category) continue;\n                    command.opts.category = parentDirName;\n                }\n            }\n\n            commands = commands.concat(newCommands);\n        }\n\n        return commands;\n    }\n\n    /**\n     * Adds middleware which take priority over existing middleware to commands\n     * @param commands commands to add middleware to\n     * @param middleware middleware to add\n     */\n    export async function prependMiddleware(commands: Command[], ...middleware: CommandHandler[]): Promise<void> {\n        for (let command of commands) {\n            (command.opts.guards || (command.opts.guards = [])).unshift(...middleware);\n        }\n    }\n\n    /**\n     * Executes all middleware on a commmand, resolves when done\n     * @param message \n     * @param middleware \n     * @returns whether this was successful\n     */\n    export function executeMiddleware(message: Message, middleware: CommandHandler[]): Promise<void> {\n        return new Promise((resolve, reject) => {\n            let idx = -1;\n            const next = async (err?: any) => {\n                if (err) {\n                    // send error down the chain\n                    return reject(err);\n                }\n                idx++;\n                if (!middleware[idx]) return resolve();\n                // allows guards to throw CommandErrors and sends it down the chain\n                try {\n                    await middleware[idx](message, next);\n                } catch (e) {\n                    return reject(e);\n                }\n            };\n            next();\n        });\n    }\n\n    /**\n     * Adds bot branding to an embed\n     * @param embed embed to brand\n     */\n    export const specializeEmbed = (embed: RichEmbed | RichEmbedOptions) => {\n        if (embed instanceof RichEmbed) embed.setFooter(Constants.BOT_AUTHOR, Constants.BOT_ICON);\n        else embed.footer = {text: Constants.BOT_AUTHOR, icon_url: Constants.BOT_ICON};\n        return embed;\n    };\n\n    export interface CommandResult {\n        deleted?: boolean;\n        reply?: [string | MessageOptions | undefined, MessageOptions | undefined];\n        edit?: [string, MessageEditOptions | RichEmbed | undefined];\n        pinned?: boolean;\n        unpinned?: boolean;\n        completed?: boolean;\n        warning?: boolean;\n        error?: CommandError;\n    }\n    \n    export async function runCommand(baseMessage: Message, command: string, user?: User) {\n        const actionLog: CommandResult[] = [];\n    \n        user = user || baseMessage.author;\n    \n        const trackAction: (result: CommandResult) => Message = result => {\n            actionLog.push(result);\n            return baseMessage;\n        }\n    \n        command = `${Constants.COMMAND_PREFIX}${command}`;\n    \n        baseMessage = new Message(baseMessage.channel, { ...baseMessage.__data, author: user}, baseMessage.client);\n    \n        baseMessage.id = null as any;\n        baseMessage.content = command;\n        baseMessage.pinned = false;\n        baseMessage.tts = false;\n        baseMessage.embeds = [];\n        baseMessage.attachments = new Collection();\n        baseMessage.createdTimestamp = new Date().getTime();\n        baseMessage.editedTimestamp = null as any;\n        baseMessage.reactions = new Collection();\n        baseMessage.mentions = new (MessageMentions as any)(baseMessage);\n        baseMessage.webhookID = null as any;\n    \n        baseMessage.delete = async () => trackAction({deleted: true});\n        baseMessage.reply = async (...args: any[]) => trackAction({reply: args as any});\n        baseMessage.edit = async (...args: any[]) => trackAction({edit: args as any});\n        baseMessage.pin = async () => trackAction({pinned: true});\n        baseMessage.unpin = async () => trackAction({unpinned: true});\n        baseMessage.complete = baseMessage.success = baseMessage.done = async () => trackAction({completed: true}) as any;\n        baseMessage.warning = baseMessage.danger = baseMessage.caution = async () => trackAction({warning: true}) as any;\n        baseMessage.renderError = async error => trackAction({error}) as any;\n    \n        await baseMessage.client.botkit.commandSystem.messageIntake(baseMessage);\n    \n        return actionLog.reduce((obj, c) => {\n            Object.keys(c).forEach(key => obj[key] = c[key]);\n            return obj;\n        }, {});\n    }\n}"]}