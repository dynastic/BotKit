{"version":3,"file":"commands.js","sourceRoot":"./src/","sources":["commands/commands.ts"],"names":[],"mappings":"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","sourcesContent":["import { Client, Collection, GuildMember, Guild, Message, RichEmbed, TextChannel, User } from 'discord.js';\nimport util from 'util';\n\nimport { COMMAND_PREFIX } from '../Constants';\nimport {CommandError} from './errors';\nimport { Argumented } from './guards';\nimport { AccessLevel, Command, Commands } from './util';\nimport { Application } from '..';\n\nexport const HelpCommand: Command = {\n    opts: {\n        name: \"help\",\n        access: AccessLevel.EVERYONE,\n        guards: [Argumented(\"help\", \"Provides help about all commands in this bot\", [{name: \"command\", type: \"string\", required: false}])]\n    },\n    handler: async (message, next) => {\n        const [specificCommand] = message.args;\n\n        // command manpage\n        if (specificCommand) {\n            const command = message.client.botkit.commandSystem.commands[specificCommand as string];\n            if (!command) {\n                return next(new CommandError({message: \"That command does not exist.\"}));\n            }\n            const metadata = message.client.botkit.commandSystem.metadata[command.opts.name];\n            if (!metadata || (!metadata.description && !metadata.syntax)) {\n                return next(new CommandError({message: \"There's no additional help data for this command.\"}));\n            }\n            const {description, syntax} = metadata;\n            const embed = new RichEmbed();\n            embed.setTitle(`Information about \\`${command.opts.name}\\``);\n            if (description) embed.addField(\"Description\", description);\n            if (syntax) embed.addField(\"Syntax\", `\\`${syntax}\\``);\n            await message.reply(embed);\n            return;\n        }\n\n        const commands: {[category: string]: string[]} = {};\n        const loadedCommands = message.client.botkit.commandSystem.commands;\n\n        for (let commandName in loadedCommands) {\n            if (!(await (message.member || message.author).hasAccess(commandName))) continue;\n            const command = loadedCommands[commandName];\n            if (!command) continue;\n            const category = command.opts.category || \"General\";\n            (commands[category] || (commands[category] = [])).push(`â€¢ \\`${COMMAND_PREFIX}${command.opts.name}\\``);\n        }\n\n        const helpEmbed = new RichEmbed();\n\n        for (let category in commands) {\n            const commandList = commands[category].join(\"\\n\");\n\n            helpEmbed.addField(`${category}:`, commandList);\n        }\n\n        helpEmbed.setTitle(\"Available Commands\");\n\n        message.reply(\"\", {embed: helpEmbed});\n    }\n};\n\nexport const PingCommand: Command = {\n    opts: {\n        name: \"ping\",\n        category: \"Diagnostics\",\n        access: AccessLevel.EVERYONE,\n        guards: [Argumented(\"ping\", \"Calculates the latency between the bot and server\", [])]\n    },\n    handler: async (message, next) => {\n        const startTime = Date.now();\n\n        const msg = await message.reply(\"Ping...\") as Message;\n        \n        await msg.edit(`Ponged in ${msg.createdTimestamp - startTime}ms`);\n    }\n};\n\nexport interface Context {\n    message: Message;\n    app: Application;\n    args: string[];\n    author: User;\n    channel: TextChannel;\n    guild: Guild;\n    client: Client;\n    [key: string]: any;\n}\n\nexport const EvalCommand: Command = {\n    opts: {\n        name: \"eval\",\n        category: \"Diagnostics\",\n        access: AccessLevel.ROOT,\n        node: \"debug.eval\",\n        guards: [Argumented(\"eval\", \"Evaluates the given code\", [{name: \"code\", type: \"string\", required: true, unlimited: true}])]\n    },\n    handler: async (message, next) => {\n        let context: Context = {\n            message,\n            app: message.client.botkit,\n            args: message.args as any[],\n            author: message.author,\n            channel: message.channel as any,\n            guild: message.guild,\n            client: message.client\n        };\n\n        if (message.client.botkit.options.contextPopulator) {\n            context = message.client.botkit.options.contextPopulator(context);\n        }\n\n        let res;\n        try {\n            res = eval(message.args.join(\" \"));\n        } catch (e) {\n            res = e;\n        }\n\n        const getResult = () => \"Result\\n```js\\n\" + util.inspect(res, false, 0) + \"\\n```\";\n\n        if (res instanceof Promise) {\n            const response = await message.reply(\"Promise Pending...\") as Message;\n            try {\n                res = await res;\n            } catch (e) {\n                res = e;\n            }\n\n            await response.edit(getResult());\n            return;\n        }\n\n        await message.reply(getResult());\n    }\n};\n\nexport const Moderation: Commands = {\n    opts: {\n        access: AccessLevel.MODERATOR,\n        category: \"Moderation\"\n    },\n    commands: [\n        {\n            opts: {\n                name: \"erase-channel\",\n                guards: [Argumented(\"erase-channel\", \"Erases all messages in the specified channel\", [\n                    {name: \"channel\", type: \"channel\"}\n                ])],\n                node: \"moderator.erase-channel\"\n            },\n            handler: async (msg, next) => {\n                let messages: Collection<string, Message>;\n                while ((messages = await (msg.args[0] as any as TextChannel).fetchMessages({limit: 100})).size > 0) {\n                    await msg.channel.bulkDelete(messages);\n                }\n                await msg.author.send(`I'm done cleaning <#${msg.channel.id}>`);\n            }\n        }\n    ]\n};\n\nexport const UnicodeEmoji: Command = {\n    opts: {\n        name: \"unicode-emoji\",\n        guards: [\n            Argumented(\n                \"unicode-emoji\",\n                \"Sends the unicode version of the given emoji where applicable\",\n                [\n                    {\n                        name: \"emoji\",\n                        type: \"string\"\n                    }\n                ]\n            )\n        ]\n    },\n    handler: msg => msg.reply(`\\\\${msg.args[0]}`)\n}\n\nexport * from \"./permissions/commands\";"]}