{"version":3,"file":"set-manager.js","sourceRoot":"./src/","sources":["modules/set-manager.ts"],"names":[],"mappings":"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","sourcesContent":["import { GuildMember, RichEmbed, Role } from \"discord.js\";\nimport { Command, CommandError, Commands, PermissionsAPI, PermissionSet, PermissionSetEntity } from \"..\";\nimport { CommandUtils } from \"../commands\";\nimport { PermSetLoader } from \"../commands/guards\";\n\ninterface PermSetContainer { permSet: PermissionSetEntity }\n\nconst fallbackStr = (str1: string, str2: string) => str1.trim().length > 0 ? str1 : str2;\n\nconst createPermissionDepictionEmbed = (sets: PermissionSetEntity | PermissionSetEntity[], target: Role | GuildMember) => {\n    let set: PermissionSet;\n\n    if (Array.isArray(sets)) {\n        set = PermissionsAPI.compositePermissionSet(sets);\n    } else {\n        set = sets[0];\n    }\n\n    const embed = new RichEmbed();\n\n    if (target instanceof GuildMember) {\n        const superuser = target.client.botkit.options.superuserCheck && target.client.botkit.options.superuserCheck(target.id);\n        embed.addField(\"Superuser\", !!superuser, true);\n    }\n\n    if (Array.isArray(sets)) {\n        const setList = sets.map(subset => `\\`${subset.name}\\``).join(\"\\n\");\n\n        embed.addField(\"Set List\", fallbackStr(setList, \"None\"), false);\n    }\n\n    const grantList = set.grantedPermissions.map(perm => `\\`${perm}\\``).join(\"\\n\");\n    const negateList = set.negatedPermissions.map(perm => `\\`${perm}\\``).join(\"\\n\");\n\n    embed.addField(\"Granted Permissions\", fallbackStr(grantList, \"None\"), true);\n    embed.addField(\"Negated Permissions\", fallbackStr(negateList, \"None\"), true);\n\n    return embed;\n}\n\nconst MemberRoleListGenerator: (type: \"members\" | \"roles\") => Command = type => ({\n    opts: {\n        name: `get-${type}`,\n        node: \"perm.read\",\n        usage: {\n            description: `List all ${type === \"members\" ? \"users\" : type} in a set`,\n            args: [\n                {\n                    type: \"string\",\n                    description: `The set to look up`,\n                    name: \"name\",\n                    required: true\n                }\n            ]\n        },\n        guards: [\n            PermSetLoader\n        ]\n    },\n    handler: async message => {\n        const permSet: PermissionSetEntity = message.data.permSet;\n\n        const targetList = permSet[type].map(id => `<@${type === \"roles\" ? '&' : ''}${id}>`).join(\"\\n\");\n\n        const embed = new RichEmbed();\n        embed.setTitle(\"Permissions Query Report\");\n        embed.addField(\"Permission Set\", `\\`${permSet.name}\\``, false);\n        embed.addField(`${type === \"members\" ? \"User\" : type === \"roles\" ? \"Role\" : (type as string).capitalize()} List`, fallbackStr(targetList, \"None\"), false);\n\n        await message.reply(embed);\n    }\n});\n\nconst PermissionStateGenerator: (action: \"add\" | \"del\") => Command = action => ({\n    opts: {\n        name: `${action}-permission`,\n        node: \"perm.write\",\n        usage: {\n            description: \"Updates the status of a permission in a permission set\",\n            args: [\n                {\n                    type: \"string\",\n                    name: \"permission-set\",\n                    description: \"The permission set to look up\",\n                    required: true\n                },\n                {\n                    type: \"string\",\n                    name: \"permissions\",\n                    description: \"The permissions to alter\",\n                    required: true,\n                    unlimited: true\n                }\n            ]\n        },\n        guards: [\n            PermSetLoader\n        ]\n    },\n    handler: async message => {\n        const [, ...permissions] = message.args as string[];\n\n        const { permSet } = message.data as PermSetContainer;\n\n        console.log(permissions);\n\n        permissions.forEach(permission => {\n            let targetNegated: boolean = false;\n\n            if (permission.startsWith(\"-\") || permission.startsWith(\"!\")) {\n                targetNegated = true;\n                permission = permission.substring(1);\n            }\n\n            if (action === \"add\") {\n                if (targetNegated) {\n                    permSet.negate(permission);\n                } else {\n                    permSet.grant(permission);\n                }\n            } else {\n                if (targetNegated) {\n                    permSet.negatedPermissions.remove(permission);\n                } else {\n                    permSet.grantedPermissions.remove(permission);\n                }\n            }\n        });\n\n        await permSet.save();\n        await message.success();\n    }\n})\n\nconst membershipStateGenerator: (type: \"member\" | \"role\", mode: \"add\" | \"del\") => Command = (type, mode) => ({\n    opts: {\n        // manuadd\n        // manudel\n        // manradd\n        // manrdel\n        name: `${mode}-${type}`,\n        node: \"perm.write\",\n        usage: {\n            description: `${mode.capitalize().replace(\"Del\", \"Remove\")} a ${type} ${mode === \"add\" ? \"to\" : \"from\"} a permission set`,\n            args: [\n                {\n                    type: \"string\",\n                    name: \"name\",\n                    description: \"The permission set to modify\",\n                    required: true\n                },\n                {\n                    type,\n                    name: type + \"s\",\n                    description: \"The targets to assign sets to\",\n                    required: true,\n                    unlimited: true\n                }\n            ]\n        },\n        guards: [\n            PermSetLoader\n        ]\n    },\n    handler: async (message) => {\n        let ids = message.args.slice(1) as Array<GuildMember | Role>;\n        ids = ids.filter((id: null | { id: string }) => id !== null && id.id);\n        const { permSet } = message.data as PermSetContainer;\n\n        await Promise.all(ids.map(({ id }) => permSet[mode + \"Target\"](type, id)));\n\n        await permSet.save();\n\n        await message.success();\n    }\n})\n\nexport const SetManager: Commands = {\n    opts: {\n        category: \"Set Manager\",\n        environments: ['text']\n    },\n    commands: [\n        {\n            opts: {\n                name: \"get-set\",\n                node: \"perm.read\",\n                usage: {\n                    description: \"Get a permission set\",\n                    args: [\n                        {\n                            type: \"string\",\n                            name: \"name\",\n                            description: \"The set to look up\",\n                            required: true\n                        }\n                    ]\n                },\n                guards: [\n                    PermSetLoader\n                ]\n            },\n            handler: async (message, next) => {\n                const permSet: PermissionSetEntity = message.data.permSet;\n\n                const embed = new RichEmbed();\n                embed.addField(\"Name\", permSet.name, false);\n                embed.addField(\"Roles\", fallbackStr(permSet.roles.map(id => `<@&${id}>`).join(\"\\n\"), \"None\"), true);\n                embed.addField(\"Members\", fallbackStr(permSet.members.map(id => `<@${id}>`).join(\"\\n\"), \"None\"), true);\n                embed.addField(\"Granted Permissions\", fallbackStr(permSet.grantedPermissions.map(perm => `\\`${perm}\\``).join(\"\\n\"), \"None\"), false);\n                embed.addField(\"Negated Permissions\", fallbackStr(permSet.negatedPermissions.map(perm => `\\`${perm}\\``).join(\"\\n\"), \"None\"), false);\n\n                await message.reply(embed);\n            }\n        },\n        {\n            opts: {\n                name: \"add-set\",\n                node: \"perm.write\",\n                usage: {\n                    description: \"Add a permission set\",\n                    args: [\n                        {\n                            type: \"string\",\n                            name: \"name\",\n                            description: \"The name of the set you're creating\",\n                            required: true\n                        }\n                    ]\n                },\n                guards: [\n                    PermSetLoader\n                ]\n            },\n            handler: async (message, next) => {\n                const [name] = message.args as string[];\n\n                const { permSet } = message.data as PermSetContainer;\n\n                if (permSet) {\n                    return next(new CommandError({\n                        message: \"A permission set already exists with that name. Please choose another one or delete that permission set.\",\n                        title: \"Naming Conflict\"\n                    }))\n                }\n\n                await message.client.botkit.options.permissionsEntity!.create({\n                    name,\n                    guild: message.guild.id,\n                    roles: [],\n                    members: [],\n                    grantedPermissions: [],\n                    negatedPermissions: []\n                })\n\n                // depict the permission set we just made\n                const reply = await CommandUtils.runCommand(message, `mansget ${name}`);\n\n                if (reply.reply) {\n                    await message.reply(...reply.reply);\n                } else {\n                    return next(new CommandError({\n                        message: \"An error occurred while making the permission set.\",\n                        title: \"Unknown Error\"\n                    }));\n                }\n            }\n        },\n        {\n            opts: {\n                name: \"list-sets\",\n                node: \"perm.read\"\n            },\n            handler: async (message, next) => {\n                const sets = await message.client.botkit.options.permissionsEntity!.find({ guild: message.guild.id });\n\n                const setList = sets.map(set => `\\`${set.name}\\``).sort().join(\"\\n\");\n\n                const embed = new RichEmbed();\n\n                embed.addField(\"Guild\", `${message.guild.name} (${message.guild.id})`);\n                embed.addField(\"Permission Sets\", fallbackStr(setList, \"None\"));\n                embed.setTitle(\"Permission Set Overview\");\n\n                await message.reply(embed);\n            }\n        },\n        {\n            opts: {\n                name: \"del-set\",\n                node: \"perm.write\",\n                usage: {\n                    description: \"Delete a permission set\",\n                    args: [\n                        {\n                            type: \"string\",\n                            name: \"names\",\n                            description: \"The set(s) to delete\",\n                            required: true,\n                            unlimited: true\n                        }\n                    ]\n                }\n            },\n            handler: async (message, next) => {\n                const permSetNames = message.args as string[];\n                \n                await Promise.all(permSetNames.map(name => message.client.botkit.options.permissionsEntity!.findOne({name, guild: message.guild.id})).map(permSet => permSet.then(set => set as any && set!.remove())));\n\n                await message.success();\n            }\n        },\n        {\n            opts: {\n                name: \"get-member\",\n                node: \"perm.read\",\n                usage: {\n                    description: \"Get information on a member's permissions\",\n                    args: [\n                        {\n                            type: \"member\",\n                            name: \"member\",\n                            description: \"The member to look up\",\n                            required: true\n                        }\n                    ]\n                }\n            },\n            handler: async (message, next) => {\n                const [member] = message.args as GuildMember[];\n\n                const sets = await message.client.botkit.options.permissionsEntity!.createQueryBuilder()\n                                .where(\"members @> :member\", { member: [member.id] })\n                                .andWhere(\"guild = :guild\", { guild: message.guild.id })\n                                .getMany();\n\n                const embed = createPermissionDepictionEmbed(sets, member);\n                embed.setTitle(\"Member Permissions Profile\");\n\n                await message.reply(embed);\n            }\n        },\n        // manulist\n        MemberRoleListGenerator(\"members\"),\n        // manrlist\n        MemberRoleListGenerator(\"roles\"),\n        {\n            opts: {\n                name: \"get-role\",\n                node: \"perm.read\",\n                usage: {\n                    description: \"Get information on a role's permissions\",\n                    args: [\n                        {\n                            type: \"role\",\n                            name: \"role\",\n                            description: \"The role to look up\",\n                            required: true\n                        }\n                    ]\n                }\n            },\n            handler: async (message, next) => {\n                const [role] = message.args as Role[];\n\n                const sets = await message.client.botkit.options.permissionsEntity!.createQueryBuilder()\n                                .where(\"roles @> :roles\", { roles: [role.id] })\n                                .getMany();\n\n                const embed = createPermissionDepictionEmbed(sets, role);\n                embed.setTitle(\"Role Permissions Profile\");\n\n                await message.reply(embed);\n            }\n        },\n        // manuadd\n        membershipStateGenerator(\"member\", \"add\"),\n        // manudel\n        membershipStateGenerator(\"member\", \"del\"),\n        // manradd\n        membershipStateGenerator(\"role\", \"add\"),\n        // manrdel\n        membershipStateGenerator(\"role\", \"del\"),\n        // manpadd\n        PermissionStateGenerator(\"add\"),\n        // manpdel\n        PermissionStateGenerator(\"del\")\n    ]\n}"]}