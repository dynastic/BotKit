{"version":3,"file":"commands.js","sourceRoot":"./src/","sources":["src/commands/commands.ts"],"names":[],"mappings":"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","sourcesContent":["import { Client, Guild, Message, RichEmbed, TextChannel, User } from 'discord.js';\nimport util from 'util';\nimport { Application } from '..';\nimport { CommandError } from './errors';\nimport { Command } from './util';\n\nexport const HelpCommand: Command = {\n    opts: {\n        name: \"help\",\n        usage: {\n            description: \"Provides help about all commands in this bot\",\n            args: [\n                {\n                    name: \"command\",\n                    type: \"string\",\n                    required: false,\n                    description: \"The command to look up\"\n                }\n            ]\n        }\n    },\n    handler: async (message, next) => {\n        const [specificCommand] = message.args;\n\n        // command manpage\n        if (specificCommand) {\n            const command = message.client.botkit.commandSystem.commands[specificCommand as string];\n            if (!command) {\n                return next(new CommandError({ message: \"That command does not exist.\" }));\n            }\n            const { usage } = command.opts;\n            if (!usage) {\n                return next(new CommandError({ message: \"There's no additional help data for this command.\" }));\n            }\n            const { description, syntax } = <any>usage as { [key: string]: string };\n            const embed = new RichEmbed();\n            embed.setTitle(`Information about \\`${command.opts.name}\\``);\n            if (description) embed.setDescription(description);\n            if (syntax) embed.addField(\"Syntax\", `\\`${message.commandPrefix}${syntax}\\``);\n            if (usage.args) {\n                usage.args.forEach((arg, i) => {\n                    if (!arg) {\n                        return;\n                    }\n                    const title = `${i}${arg.unlimited ? \"...\" : \".\"} ${arg.name.capitalize()}`;\n                    let body = \"\";\n\n                    if (arg.description) body += `Description: \\`${arg.description}\\`\\n`;\n                    body += `Type: \\`${arg.type}\\`\\n`;\n                    body += `Optional: \\`${arg.required === false}\\``;\n\n                    embed.addField(title, body);\n                });\n            }\n            await message.reply(embed);\n            return;\n        }\n\n        const commands: { [category: string]: string[] } = {};\n        const loadedCommands = message.client.botkit.commandSystem.commands;\n\n        for (let commandName in loadedCommands) {\n            if (!(await (message.member || message.author).hasAccess(commandName))) continue;\n            const command = loadedCommands[commandName];\n            if (!command) continue;\n            const category = command.opts.category || \"General\";\n            (commands[category] || (commands[category] = [])).push(`â€¢ \\`${message.commandPrefix}${command.opts.name}\\``);\n        }\n\n        const helpEmbed = new RichEmbed();\n\n        for (let category in commands) {\n            const commandList = commands[category].join(\"\\n\");\n\n            helpEmbed.addField(`${category}:`, commandList, true);\n        }\n\n        helpEmbed.setTitle(\"Available Commands\");\n\n        message.reply(\"\", { embed: helpEmbed });\n    }\n};\n\nconst pingSuffix = () => ['?', '!', '?!', '!?', '?!?', '!?!', '!!?', '?!!', '!?!'].random();\n\nexport const PingCommand: Command = {\n    opts: {\n        name: \"ping\",\n        category: \"Diagnostics\",\n        usage: {\n            description: \"Calculates the latency between the bot and server\"\n        }\n    },\n    handler: async (message, next) => {\n        const startTime = Date.now();\n\n        const embed = new RichEmbed();\n        embed.setTitle(`Ping${pingSuffix()} Ping${pingSuffix()} Ping${pingSuffix()}`);\n        embed.setDescription(`Ping${pingSuffix()}`);\n\n        let msg: Message;\n        const reloadVariables = () => {\n            embed.fields = [];\n\n            const startToNow = Date.now() - message.metrics.start;\n\n            embed.addField(`Command runtime duration  `, `${startToNow}ms`, true);\n            if (msg) embed.addField(`Message ponged in`, `${msg.createdTimestamp - startTime}ms`, true);\n        }\n        reloadVariables();\n\n        msg = await message.channel.send(embed) as Message;\n\n        reloadVariables();\n        embed.setDescription(\"***PONG.***\");\n\n        await msg.edit(embed);\n    }\n};\n\nexport interface Context {\n    message: Message;\n    app: Application;\n    args: string[];\n    author: User;\n    channel: TextChannel;\n    guild: Guild;\n    client: Client;\n    [key: string]: any;\n}\n\nexport const EvalCommand: Command = {\n    opts: {\n        name: \"eval\",\n        category: \"Diagnostics\",\n        node: \"debug.eval\",\n        usage: {\n            description: \"Evaluates the given code\",\n            args: [\n                {\n                    type: \"string\",\n                    name: \"code\",\n                    required: true,\n                    unlimited: true,\n                    description: \"The code you want to evaluate\"\n                }\n            ]\n        }\n    },\n    handler: async (message, next) => {\n        let context: Context = {\n            message,\n            app: message.client.botkit,\n            args: message.args as any[],\n            author: message.author,\n            channel: message.channel as any,\n            guild: message.guild,\n            client: message.client\n        };\n\n        if (message.client.botkit.options.contextPopulator) {\n            context = message.client.botkit.options.contextPopulator(context);\n        }\n\n        let res;\n        try {\n            res = eval(message.args.join(\" \"));\n        } catch (e) {\n            res = e;\n        }\n\n        const getResult = () => \"Result\\n```js\\n\" + util.inspect(res, false, 0) + \"\\n```\";\n\n        if (res instanceof Promise) {\n            const response = await message.reply(\"Promise Pending...\") as Message;\n            try {\n                res = await res;\n            } catch (e) {\n                res = e;\n            }\n\n            await response.edit(getResult());\n            return;\n        }\n\n        await message.reply(getResult());\n    }\n};"]}